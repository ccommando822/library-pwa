<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rakshapal Singh Library ERP</title>
  <style>
    :root { --primary: #1976d2; --bg: #f4f7f6; --dark: #1c1e21; --green: #2ecc71; --red: #e74c3c; --black: #000000; --yellow: #f1c40f; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--dark); }
    header { background: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 18px; }
    nav { display: flex; background: white; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 1000; }
    nav button { flex: 1; padding: 15px; border: none; background: none; cursor: pointer; font-weight: bold; color: #666; }
    nav button.active { border-bottom: 3px solid var(--primary); color: var(--primary); }
    section { padding: 15px; display: none; max-width: 500px; margin: auto; }
    section.active { display: block; }
    .card { background: white; padding: 20px; margin-bottom: 15px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .detail-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
    .detail-content { flex: 1; }
    .detail-label { font-size: 10px; color: var(--primary); font-weight: bold; text-transform: uppercase; }
    .detail-content input, .detail-content textarea { border: none; background: transparent; font-size: 16px; width: 100%; outline: none; padding: 4px 0; font-family: inherit; }
    .detail-content input:not([readonly]), .detail-content textarea:not([readonly]) { border-bottom: 1.5px solid var(--primary); background: #fffde7; }
    .pencil-btn { cursor: pointer; color: var(--primary); font-size: 18px; padding-left: 10px; }
    .wizard-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; padding: 20px; box-sizing: border-box; display: none; }
    .wizard-overlay.show { display: block; overflow-y: auto; }
    .step-card { border: 2px solid #eee; border-radius: 12px; padding: 15px; margin-bottom: 20px; transition: 0.3s; opacity: 0.6; pointer-events: none; }
    .step-active { border-color: var(--primary); background: #f0f7ff; opacity: 1; pointer-events: auto; }
    .step-num { background: var(--primary); color: white; border-radius: 50%; width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 12px; }
    #pay-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:3000; display:none; align-items:center; justify-content:center; }
    .modal-box { background:white; padding:30px; border-radius:15px; width:80%; max-width:350px; text-align:center; }
    .player-card { background: #242526; color: #e4e6eb; border-radius: 12px; padding: 10px; display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; border-left: 4px solid var(--primary); position: relative; }
    .player-photo { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; border: 1px solid #444; }
    .player-surv { position: absolute; right: 10px; font-size: 10px; font-weight: bold; }
    .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 15px; margin-top: 10px; transition: 0.3s; }
    .btn-blue { background: var(--primary); color: white; }
    .btn-green { background: var(--green); color: white; }
    .btn-outline { background: transparent; border: 1.5px solid var(--red); color: var(--red); }
    .hidden { display: none !important; }
    /* CHAT STYLE LOGS: Newest at bottom */
    .log-container { max-height: 200px; overflow-y: auto; font-size: 11px; margin-top: 8px; display: flex; flex-direction: column; }
    .log-expanded { max-height: none !important; }
    .division-header { background: #e2e8f0; padding: 8px 12px; font-size: 11px; font-weight: bold; color: #475569; border-radius: 6px; margin: 15px 0 8px 0; text-transform: uppercase; }
  </style>
</head>
<body>

<header>Rakshapal Singh Library</header>

<div id="pay-modal" onclick="this.style.display='none'">
    <div class="modal-box">
        <h3 style="color:var(--primary); margin-top:0;">Payment Initiated</h3>
        <p style="font-size:14px; color:#333;">Owner will verify shortly.</p>
        <p style="font-size:16px; font-weight:bold; color:var(--red);">Call 7500159996 for verification.</p>
    </div>
</div>

<nav id="main-nav">
  <button id="tab-acc" class="active" onclick="switchMain('account')">Account</button>
  <button id="tab-man" class="hidden" onclick="switchMain('manage')">Manage üõ†</button>
</nav>

<section id="account" class="active">
  <div id="loginPanel" class="card" style="text-align:center;">
    <button class="btn btn-blue" onclick="window.login()">Sign in with Google</button>
  </div>

  <div id="profilePanel" class="hidden">
    <div class="card" id="profile-card" style="text-align:center; border-bottom: 4px solid var(--primary);">
      <img id="u-img" style="width:80px; height:80px; border-radius:50%; margin-bottom:10px;">
      <div id="status-joined" style="font-size: 12px; color: #666; font-weight: bold;">NOT JOINED YET</div>
      <div id="expire-label" style="font-size: 28px; font-weight: 900; color: var(--red); display:none; margin-bottom:-5px;">EXPIRED</div>
      <div id="status-days" style="font-size: 24px; font-weight: 900; color: #ccc;">--</div>
      <div style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">Survival Remaining</div>
    </div>

    <div class="card" id="details-panel">
      <div class="detail-row"><div class="detail-content"><label class="detail-label">Full Name</label><input type="text" id="p-name" readonly></div><span class="pencil-btn" onclick="makeEdit('p-name')">‚úèÔ∏è</span></div>
      <div class="detail-row"><div class="detail-content"><label class="detail-label">Father's Name</label><input type="text" id="p-father" readonly></div><span class="pencil-btn" onclick="makeEdit('p-father')">‚úèÔ∏è</span></div>
      <div class="detail-row"><div class="detail-content"><label class="detail-label">Date of Birth</label><input type="date" id="p-dob" readonly></div><span class="pencil-btn" onclick="makeEdit('p-dob')">‚úèÔ∏è</span></div>
      <div class="detail-row"><div class="detail-content"><label class="detail-label">Mobile Number</label><input type="tel" id="p-phone" readonly></div><span class="pencil-btn" onclick="makeEdit('p-phone')">‚úèÔ∏è</span></div>
      <div class="detail-row"><div class="detail-content"><label class="detail-label">Address</label><textarea id="p-address" readonly rows="2"></textarea></div><span class="pencil-btn" onclick="makeEdit('p-address')">‚úèÔ∏è</span></div>
      <button class="btn btn-green" onclick="window.saveProfile()">Save Folder Details</button>
    </div>

    <div class="card"><label class="detail-label">Payment & Membership Logs</label><div id="user-pay-log" class="log-container"></div></div>

    <div id="join-trigger-box"><button class="btn btn-blue" onclick="openWizard()">Join the Library</button></div>
    <div id="active-tools" class="hidden">
        <div class="card" style="background: #f0f7ff;">
            <label class="detail-label">Renewal Panel</label>
            <select id="p-shift" onchange="calcTotal()" style="width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ccc;">
                <option value="500">Day Shift (‚Çπ500/28d)</option>
                <option value="400">Night Shift (‚Çπ400/28d)</option>
                <option value="700">Both Shift (‚Çπ700/28d)</option>
            </select>
            <input type="number" id="p-days" value="28" max="364" oninput="calcTotal()" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">
            <div id="pay-summary" style="font-weight:bold; color:var(--primary);">Total Amount: ‚Çπ500</div>
            <button class="btn btn-blue" onclick="window.doPayment()">Secure UPI Payment</button>
        </div>
        <button class="btn btn-outline" onclick="window.openLeaveWizard()">Leave Library Membership</button>
    </div>
    <button style="width:100%; background:none; border:none; color:gray; padding:20px; cursor:pointer;" onclick="window.logout()">Logout Account</button>
  </div>
</section>

<div id="joinWizard" class="wizard-overlay">
    <h2 style="color:var(--primary);">Admission Wizard</h2>
    <div id="step1" class="step-card step-active"><span class="step-num">1</span> <b>Verify Folder Details</b><button class="btn btn-blue" onclick="window.checkStepOne()">Check & Lock Details</button></div>
    <div id="step2" class="step-card"><span class="step-num">2</span> <b>Verify Identity</b><input type="number" id="join-otp" placeholder="6-digit OTP" style="width:100%; padding:15px; font-size:20px; border-radius:10px; border:2px solid #ddd;"><button class="btn btn-black" onclick="window.verifyJoin()">Proceed</button></div>
    <button class="btn" style="background:none; color:gray;" onclick="closeWizard()">Cancel</button>
</div>

<div id="leaveWizard" class="wizard-overlay">
    <h2 style="color:var(--red);">Membership Exit</h2>
    <div id="lstep1" class="step-card step-active">
        <span class="step-num">1</span> <b>Check Fees History</b>
        <div id="leave-error-box" class="hidden">
            <p id="leave-error-msg" style="color:var(--red); font-weight:bold;"></p>
            <button class="btn btn-blue" onclick="window.payDebtAndExit()">Pay Fees & Exit</button>
        </div>
        <button id="leave-verify-btn" class="btn btn-blue" onclick="window.checkLeaveFees()">Verify Fees Paid</button>
    </div>
    <div id="lstep2" class="step-card"><span class="step-num">2</span> <b>Exit Approval</b><input type="number" id="leave-otp" placeholder="6-digit OTP" style="width:100%; padding:15px; font-size:20px; border-radius:10px; border:2px solid #ddd;"><button class="btn btn-black" onclick="window.verifyLeave()">Confirm Exit</button></div>
    <button class="btn" style="background:none; color:gray;" onclick="closeLeaveWizard()">Cancel</button>
</div>

<section id="manage">
    <div class="admin-nav" style="display:flex; gap:5px; padding:5px; background:#eee; border-radius:10px; margin-bottom:15px;">
        <button id="am-otp-btn" class="active" onclick="switchAdmin('otp')" style="flex:1; border:none; padding:10px; border-radius:8px; font-weight:bold;">Signals</button>
        <button id="am-user-btn" onclick="switchAdmin('user')" style="flex:1; border:none; padding:10px; border-radius:8px; font-weight:bold;">Survivals</button>
    </div>
    <div id="am-pane-otp"><div class="card" id="admin-otp-list" style="background:#000; color:#0f0; font-family:monospace; min-height:100px;"></div></div>
    <div id="am-pane-user" class="hidden"><div id="admin-survival-list"></div></div>
</section>

<div id="owner-folder-view" class="wizard-overlay" style="background:var(--bg);">
    <div style="max-width:500px; margin:auto; padding:15px;">
        <button class="btn btn-black" onclick="document.getElementById('owner-folder-view').classList.remove('show')">‚Üê Back to List</button>
        <div id="folder-content"></div>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, deleteDoc, arrayUnion, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = { apiKey: "AIzaSyDjn6u195jqewM53qb2xnrPruFnMOELAcc", authDomain: "rakshapal-singh-library-ded2e.firebaseapp.com", projectId: "rakshapal-singh-library-ded2e", storageBucket: "rakshapal-singh-library-ded2e.firebasestorage.app", messagingSenderId: "988319651464", appId: "1:988319651464:web:477fa283cddb1d1123713d" };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  let currentUserData = {};
  let survivalDays = 0;
  const getStamp = () => new Date().toLocaleString('en-GB');

  const formatSurv = (days) => {
    const abs = Math.abs(days), d = Math.floor(abs + 0.00001), h = Math.floor(((abs + 0.00001) - d) * 24);
    return `${days < 0 ? '-' : ''}${d} days ${h} hours`;
  };

  const updateUI = (days, elId, lblId) => {
    const el = document.getElementById(elId), lbl = document.getElementById(lblId);
    el.innerText = formatSurv(days);
    if(lbl) lbl.style.display = days < -28 ? 'block' : 'none';
    el.style.color = days >= 0 ? "var(--green)" : (days >= -28 ? "var(--yellow)" : "var(--red)");
  };

  window.switchMain = (t) => {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(t).classList.add('active');
    document.querySelectorAll('#main-nav button').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-'+t.substring(0,3)).classList.add('active');
  };

  window.switchAdmin = (t) => {
    document.getElementById('am-pane-otp').classList.toggle('hidden', t !== 'otp');
    document.getElementById('am-pane-user').classList.toggle('hidden', t !== 'user');
    document.getElementById('am-otp-btn').classList.toggle('active', t === 'otp');
    document.getElementById('am-user-btn').classList.toggle('active', t === 'user');
  };

  onAuthStateChanged(auth, async (user) => {
    if(user) {
      onSnapshot(doc(db, "users", user.uid), (snap) => {
        if(snap.exists()) {
          currentUserData = snap.data();
          document.getElementById('loginPanel').classList.add('hidden');
          document.getElementById('profilePanel').classList.remove('hidden');
          document.getElementById('u-img').src = user.photoURL;
          ['name','father','dob','phone','address'].forEach(k => document.getElementById('p-'+k).value = currentUserData[k] || "");
          if(currentUserData.joinDateISO) {
            document.getElementById('join-trigger-box').classList.add('hidden');
            document.getElementById('active-tools').classList.remove('hidden');
            document.getElementById('status-joined').innerText = "JOINED: " + currentUserData.joinDate;
            survivalDays = (currentUserData.totalPaidDays || 0) - ((new Date() - new Date(currentUserData.joinDateISO)) / 86400000);
            updateUI(survivalDays, 'status-days', 'expire-label');
          }
          let logs = "";
          (currentUserData.history || []).forEach(m => {
            if(m.includes("Verified") || m.includes("Rejected") || m.includes("Request") || m.includes("Membership"))
              logs += `<div style="padding:5px 0; border-bottom:1px solid #eee;">${m}</div>`;
          });
          const logBox = document.getElementById('user-pay-log');
          logBox.innerHTML = logs;
          logBox.scrollTop = logBox.scrollHeight;
        }
      });
      if(user.email === "c.commando822@gmail.com") { document.getElementById('tab-man').classList.remove('hidden'); loadAdmin(); }
    }
  });

  window.saveProfile = async () => {
    const fields = { name: "Name", father: "Father's Name", dob: "D.O.B.", phone: "Phone", address: "Address" };
    const updates = {}; let logMsg = "";
    for (let [k, label] of Object.entries(fields)) {
      const val = document.getElementById('p-'+k).value.trim();
      if(val.length < 6) return alert(`${label} must be at least 6 characters!`);
      if(val !== (currentUserData[k] || "")) {
        logMsg = `Edited Profile ${label} from ${currentUserData[k] || 'Empty'} ‚Üí_‚Üí ${val} at ${getStamp()}`;
        updates[k] = val;
        await updateDoc(doc(db, "users", auth.currentUser.uid), { ...updates, history: arrayUnion(logMsg) });
      }
    }
    alert("Updated!");
  };

  window.checkStepOne = async () => {
    const isReady = ['p-name','p-father','p-dob','p-phone','p-address'].every(id => document.getElementById(id).value.trim().length >= 6);
    if(!isReady) {
        document.getElementById('details-panel').scrollIntoView();
        document.getElementById('p-name').focus();
        return alert("Redirecting: Complete profile details first!");
    }
    const otp = Math.floor(100000 + Math.random() * 900000);
    await setDoc(doc(db, "signals", auth.currentUser.uid), { otp, type: 'Admission', name: document.getElementById('p-name').value, expiresAt: Date.now() + 300000 });
    document.getElementById('step2').classList.add('step-active');
  };

  window.verifyJoin = async () => {
    const s = await getDoc(doc(db, "signals", auth.currentUser.uid));
    if(s.exists() && s.data().otp == document.getElementById('join-otp').value) {
      const bal = formatSurv(survivalDays);
      await updateDoc(doc(db, "users", auth.currentUser.uid), { 
        joinDate: new Date().toLocaleDateString(), joinDateISO: new Date().toISOString(), 
        history: arrayUnion(`üìà Membership Joined. Starting Balance: ${bal} [${getStamp()}]`) 
      });
      await deleteDoc(doc(db, "signals", auth.currentUser.uid));
      closeWizard();
    }
  };

  window.doPayment = async () => {
    let d = parseInt(document.getElementById('p-days').value), s = document.getElementById('p-shift').options[document.getElementById('p-shift').selectedIndex].text;
    let a = Math.round((parseInt(document.getElementById('p-shift').value)/28)*d);
    let reqT = getStamp(), sid = "pay_"+auth.currentUser.uid+"_"+Date.now();
    await updateDoc(doc(db, "users", auth.currentUser.uid), { history: arrayUnion(`Request: ‚Çπ${a} for ${d} days (${s}) at ${reqT}`) });
    await setDoc(doc(db, "signals", sid), { uid: auth.currentUser.uid, name: currentUserData.name, amount: a, days: d, time: reqT, type: 'PAYMENT', shift: s });
    window.location.href = `upi://pay?pa=7500159996@ptsbi&am=${a}`;
    document.getElementById('pay-modal').style.display = 'flex';
  };

  window.handlePay = async (sid, uid, stat, days, amt, reqT, shft) => {
    const ref = doc(db, "users", uid), snap = await getDoc(ref);
    const h = snap.data().history.map(l => l.includes(reqT) ? 
      `${stat=='OK'?'‚úÖ Verified':'‚ùå Rejected'}: ‚Çπ${amt} for ${days} days (${shft}) Request at ${reqT}. ${stat=='OK'?'Approved':'Rejected'} at ${getStamp()}` : l);
    await updateDoc(ref, { totalPaidDays: stat=='OK' ? (snap.data().totalPaidDays||0)+days : snap.data().totalPaidDays, history: h });
    await deleteDoc(doc(db, "signals", sid));
  };

  function loadAdmin() {
    onSnapshot(collection(db, "signals"), s => {
      let h = ""; s.forEach(d => {
        const sig = d.data();
        if(sig.type === 'PAYMENT') h += `<div>üí∞ ${sig.name}: ‚Çπ${sig.amount} (${sig.days}d - ${sig.shift})<br><button onclick="handlePay('${d.id}','${sig.uid}','OK',${sig.days},${sig.amount},'${sig.time}','${sig.shift}')">OK</button><button onclick="handlePay('${d.id}','${sig.uid}','REJ',${sig.days},${sig.amount},'${sig.time}','${sig.shift}')">X</button></div>`;
        else h += `<div>${sig.type} | ${sig.name}: ${sig.otp}</div>`;
      });
      document.getElementById('admin-otp-list').innerHTML = h || "No Signals.";
    });

    onSnapshot(collection(db, "users"), s => {
      let users = []; s.forEach(d => { 
        const u = d.data(); 
        const srv = u.joinDateISO ? (u.totalPaidDays || 0) - ((new Date() - new Date(u.joinDateISO)) / 86400000) : 0;
        users.push({...u, id: d.id, srv}); 
      });
      users.sort((a,b) => a.name.localeCompare(b.name));
      
      const grp = { onJ: "", offJ: "", onNL: "", offNL: "" };
      users.forEach(u => {
        const isJoined = !!u.joinDateISO, isNew = !u.history?.some(m => m.includes("Joined"));
        const card = `<div class="player-card" onclick="openUser('${u.id}')"><img src="${u.photo}" class="player-photo"><b>${u.name}</b><span class="player-surv" style="color:${u.srv>=0?'var(--green)':'var(--red)'}">${isJoined?formatSurv(u.srv):'--'}</span></div>`;
        if(u.isOnline && isJoined) grp.onJ += card;
        else if(!u.isOnline && isJoined) grp.offJ += card;
        else if(u.isOnline && !isJoined) grp.onNL += card;
        else grp.offNL += card;
      });
      document.getElementById('admin-survival-list').innerHTML = `
        <div class="division-header">Online (Joined)</div>${grp.onJ}
        <div class="division-header">Offline (Joined)</div>${grp.offJ}
        <div class="division-header">Online (New/Left)</div>${grp.onNL}
        <div class="division-header">Offline (New/Left)</div>${grp.offNL}`;
    });
  }

  window.openUser = async (uid) => {
    const u = (await getDoc(doc(db, "users", uid))).data();
    const curSurv = u.joinDateISO ? (u.totalPaidDays || 0) - ((new Date() - new Date(u.joinDateISO)) / 86400000) : 0;
    let pLog = "", aLog = "";
    (u.history || []).forEach(m => {
        const ent = `<div style="padding:5px 0; border-bottom:1px solid #eee;">${m}</div>`;
        if(m.includes("Verified") || m.includes("Rejected") || m.includes("Request") || m.includes("Membership")) pLog += ent; else aLog += ent;
    });
    document.getElementById('folder-content').innerHTML = `
      <div class="card" style="text-align:center;">
        <div id="adm-exp" style="font-size:28px; font-weight:900; color:var(--red); display:${curSurv < -28 ? 'block' : 'none'};">EXPIRED</div>
        <div id="adm-surv" style="font-size:24px; font-weight:900;">${formatSurv(curSurv)}</div>
      </div>
      <div class="card">
        <label class="detail-label">Adjust Survival (Formatted Balance)</label>
        <div style="font-weight:bold; margin-bottom:10px;">Current: ${formatSurv(curSurv)}</div>
        <input type="number" step="0.01" id="adm-days" value="${u.totalPaidDays}" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">
        <button class="btn btn-blue" onclick="saveAdmSurv('${uid}')">Update Balance (Total Paid Days)</button>
      </div>
      <div class="card">
        <div class="detail-label">Full Profile</div>
        <div>Name: ${u.name}</div><div>Father: ${u.father}</div><div>D.O.B: ${u.dob}</div><div>Phone: ${u.phone}</div><div>Address: ${u.address}</div>
      </div>
      <div class="card"><label class="detail-label">Payment Logs</label><div id="adm-pay-log" class="log-container" onclick="this.classList.toggle('log-expanded')">${pLog}</div></div>
      <div class="card"><label class="detail-label">Activity Logs</label><div id="adm-act-log" class="log-container" onclick="this.classList.toggle('log-expanded')">${aLog}</div></div>`;
    updateUI(curSurv, 'adm-surv', 'adm-exp');
    ['adm-pay-log','adm-act-log'].forEach(id => { const b = document.getElementById(id); if(b) b.scrollTop = b.scrollHeight; });
    document.getElementById('owner-folder-view').classList.add('show');
  };

  window.saveAdmSurv = async (uid) => {
    const v = parseFloat(document.getElementById('adm-days').value);
    await updateDoc(doc(db, "users", uid), { totalPaidDays: v, history: arrayUnion(`üõ† Admin Adjusted Balance to ${v} days [${getStamp()}]`) });
    alert("Updated.");
  };

  window.login = () => signInWithPopup(auth, provider);
  window.logout = () => signOut(auth).then(()=>location.reload());
  window.calcTotal = () => { let d = document.getElementById('p-days').value; const t = Math.round((document.getElementById('p-shift').value/28)*d); document.getElementById('pay-summary').innerText = `Total Amount: ‚Çπ${t}`; };
  window.openWizard = () => document.getElementById('joinWizard').classList.add('show');
  window.closeWizard = () => document.getElementById('joinWizard').classList.remove('show');
  window.openLeaveWizard = () => document.getElementById('leaveWizard').classList.add('show');
  window.closeLeaveWizard = () => document.getElementById('leaveWizard').classList.remove('show');
  window.makeEdit = (id) => { const el = document.getElementById(id); el.readOnly = false; el.focus(); };
</script>
</body>
</html>
